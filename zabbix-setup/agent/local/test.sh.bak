#!/bin/bash

# Step 1: Generate LLD discovery data for Zabbix
cat << EOF
{
    "data": [
        { "{#ITEMNAME}": "carrot" },
        { "{#ITEMNAME}": "banana" },
        { "{#ITEMNAME}": "lettuce" },
        { "{#ITEMNAME}": "tomato" }
    ]
}
EOF

# Step 2: Define variables for Zabbix server and host
agenthost="Host-A"
zserver="10.114.0.2"  # Replace with your actual Zabbix server IP address
zport="10051"        # Zabbix server port

# Step 3: Create an empty data file for zabbix_sender
cat /dev/null > /usr/local/zdata.txt

# Step 4: Loop through each item and generate a random value for it
for item in "carrot" "banana" "lettuce" "tomato"; do
    randnum="$(($RANDOM % 30 + 1))"  # Generate a random number between 1 and 30
    # Append the hostname, item, and value to the zdata.txt file
    echo "$agenthost instock[$item] $randnum" >> /usr/local/zdata.txt
done

# Step 5: Use zabbix_sender to send the data to the Zabbix server
zabbix_sender -vv -z $zserver -p $zport -i /usr/local/zdata.txt >> /usr/local/zsender.log 2>&1
